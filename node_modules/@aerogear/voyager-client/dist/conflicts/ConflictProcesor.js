"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
/**
 * Manipulate state of item that is being used for conflict resolution purposes.
 * This is required for the queue items so that we do not get a conflict with ourself
 * @param entry the operation which returns the result we compare with first queue entry
 */
var ConflictProcessor = /** @class */ (function () {
    function ConflictProcessor(state) {
        this.state = state;
    }
    ConflictProcessor.prototype.execute = function (queue, entry, result) {
        var operationName = entry.operation.operationName;
        if (!result || !this.state) {
            return;
        }
        if (result.data && result.data[operationName]) {
            for (var _i = 0, queue_1 = queue; _i < queue_1.length; _i++) {
                var op = queue_1[_i].operation;
                if (op.variables.id === entry.operation.variables.id
                    && op.operationName === entry.operation.operationName) {
                    var opVersion = this.state.currentState(op.variables);
                    var prevOpVersion = this.state.currentState(entry.operation.variables);
                    if (opVersion === prevOpVersion) {
                        op.variables = this.state.nextState(op.variables);
                        break;
                    }
                }
            }
        }
    };
    return ConflictProcessor;
}());
exports.ConflictProcessor = ConflictProcessor;
//# sourceMappingURL=ConflictProcesor.js.map